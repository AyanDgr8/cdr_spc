<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SPC CDR</title>
  <!-- Favicon so the tab shows the same logo -->
  <link rel="icon" type="image/png" href="/uploads/MultyLogo.png" />
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css"
  />
  <!-- Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!-- Font Awesome for spinner icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
  <style>
    body { background: #fff; }
    /* Reduce global paddings */
    .container { padding: 0.25rem; }
    .box, .p-4 { padding: 0.5rem !important; }
    .column { padding: 0.5rem !important; }
    #filtersBox { padding: 0.5rem !important; }
    .header-row { display: flex; align-items: center; justify-content: space-between; gap: 0.5rem; }
    #resultTable {
      border-collapse: collapse;
    }
    #resultTable th, #resultTable td {
      font-size: 0.8rem;
      border: 1px solid #ddd;
      padding: 0.25rem 0.5rem;
    }

    /* Record type row styling */
    .row-inbound {
      background-color: #e8f5e8 !important; /* Light green */
    }
    .row-outbound {
      background-color: #e8f0ff !important; /* Light blue */
    }
    .row-campaign {
      background-color: #fff3e0 !important; /* Light orange */
    }
    .row-cdr {
      background-color: #f3e5f5 !important; /* Light purple */
    }
    .row-cdrs_all {
      background-color: #fce4ec !important; /* Light pink */
    }
    
    /* Virtual scrolling and load more styling */
    .is-loading-more {
      padding: 1rem;
      text-align: center;
      background-color: #f5f5f5;
      border-radius: 4px;
      margin: 0.5rem 0;
    }
    
    .is-loading-more span {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: bold;
      color: #555;
    }
    
    #load-more-btn {
      transition: all 0.3s ease;
    }
    
    #load-more-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .is-hidden { display: none; }
    /* Compact styling for status/error/loading messages */
    #loading,
    #errorBox,
    #stats {
      padding: 0.25rem 0.5rem !important;
      font-size: 0.75rem !important;
    }
    /* Center the Reports title horizontally */
    .headingg {
      position:absolute;
      top:25px;
      left:50%;
      transform:translateX(-50%);
      text-align:center;
      text-transform:uppercase;
      color:#EF6F53;
      z-index:2;
    }


    /* Custom fetch button color */
    .btn-fetch {
      background-color: #1976d2 !important;
      border-color: #EF6F53 !important;
      color: #fff;
      padding: 0.1rem !important;
      font-size: 0.8rem !important;
      margin-top:-0.5rem;
    }


    /* Hover effect for Fetch Report button (when enabled) */
    .btn-fetch:hover:not([disabled]) {
      background-color: #EF6F53 !important; /* slightly darker blue */
      border-color: #1976d2 !important;
      color: #fff !important;
    }


    /* Hover effect for Download CSV button */
    #csvBtn {
      background-color: #EF6F53 !important;
      border-color: #1976d2 !important;
      color: #fff;
      padding: 0.1rem !important;
      font-size: 0.8rem !important;
      margin-top:-0.5rem;
    }


    #csvBtn:hover {
      background-color: #1976d2 !important;
      color: #fff !important;
      border-color: #EF6F53 !important;
      font-size: 0.8rem !important;
    }


     /* Active filter styling - blue color for active filters */
    .filter-active {
      background-color: #1976d2 !important;
      border-color: #EF6F53 !important;
      color: white !important;
      font-weight: 500;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }


    /* Row background colors based on record type */
    .row-inbound {
      background-color: #e3f2fd; /* light blue */
    }
    .row-outbound {
      background-color: #e8f5e9; /* light green */
    }
    .row-campaign {
      background-color: #ffebee; /* lightest red */
    }
    .row-cdr {
      background-color: #fff8e1; /* light amber/yellow */
    }
    .row-cdrs_all {
      background-color: #f3e5f5; /* light purple */
    }
    
    /* Hover effects */
    .row-inbound:hover {
      background-color: #aeecbc !important;
    }
    .row-outbound:hover {
      background-color: #86edff !important;
    }
    .row-campaign:hover {
      background-color: #ecb181 !important;
    }
    .row-cdr:hover {
      background-color: #e1bee7 !important;
    }
    .row-cdrs_all:hover {
      background-color: #f8bbd9 !important;
    }


    /* Disable Bulma hover override so custom colors remain */
    table.is-hoverable tbody tr:hover {
      background-color: inherit !important;
    }

    /* Eye button styling */
    .eye-btn {
      cursor: pointer;
      padding: 2px 8px;
      border-radius: 12px;
      background-color: #3273dc;
      color: white;
      border: none;
      font-size: 0.8rem;
      transition: all 0.2s ease;
      display: inline-block;
    }
    
    .eye-btn:hover {
      background-color: #276cda;
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    /* Eye button styling */
    .eye-btn {
      cursor: pointer;
      padding: 2px 8px;
      border-radius: 12px;
      background-color: #f5f5f5;
      border: 1px solid #ddd;
      transition: all 0.2s ease;
    }
    
    .eye-btn:hover {
      background-color: #e0e0e0;
    }
    
    /* History table styling */
    .history-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8rem;
    }
    
    .history-table th,
    .history-table td {
      border: 1px solid #dcdcdc;
      font-size: 0.7rem;
      padding: 2px 4px;
      text-align: center;
    }
    
    /* History modal specific styling */
    .history-modal-card { max-width: 800px; margin: 0 auto; }
    .history-modal-card .modal-card-head { background-color: #7b7b7b; color: white; }
    .history-modal-card .modal-card-title { color: white; }
    .history-modal-card .history-table { width: 100%; }
    
    /* History table header styling */
    .history-table th { 
      background-color: #ffffff !important; 
      color: black !important; 
      font-weight: bold !important;
      padding: 8px !important;
    }
    
    /* History table styling */
    .history-table thead { background: #fdfdfd; color: black; }
    .history-table tbody tr:nth-child(even) { background-color: #f9f9f9; color: black; }
    .history-table tbody tr:nth-child(odd) { background-color: #f9f9f9; color: black; }
    
    /* Recording modal styling */
    .recording-modal .modal-card {
      max-width: 400px;
      margin: 0 auto;
      border-radius: 8px;
      overflow: hidden;
    }
    .recording-modal .modal-card-head {
      padding: 0.25rem;
      background-color: #4a4a4a;
      color: white;
    }
    .recording-modal .modal-card-body {
      padding: 0.75rem;
    }
    .recording-modal .modal-card-title {
      font-size: 0.9rem;
      color: white;
    }
    .compact-player-controls {
      display: flex;
      gap: 0.5rem;
      justify-content: center;
      align-items: center;
    }
    .compact-play-btn {
      width: 50px !important;
      height: 50px !important;
      font-size: 1.5rem !important;
    }

    .account-row .label.is-small {
      font-size: 0.75rem;
      padding: 0.1rem 0.25rem;
    }
    .account-row input.is-small {
      font-size: 0.75rem;
      padding: 0.1rem 0.25rem;
    }
    /* Layout: form uses 30 % of the viewport height; table 50 % */
    #filterForm{
      max-height:40vh;   /* 30 % of screen height */
      overflow-y:auto;   /* scroll if it grows taller */
    }
    .table-container{
      max-height:37.5vh;   /* 50 % of screen height */
      overflow-y:auto;   /* scroll the table body */
    }


    /* --- Filter form compact spacing --- */
    #filterForm .column{
      padding-top:0.25rem !important;
      padding-bottom:0.25rem !important;
    }
    #filterForm .field{
      margin-bottom:0.25rem !important;
    }
    /* Smaller labels for datetime inputs (labels that are not .is-small) */
    #filterForm .label:not(.is-small){
      font-size:0.8rem;
      margin-bottom:0.1rem;
    }


    /* --- Sticky table header --- */
    #resultTable thead th {
      position: sticky;
      top: 0;
      z-index: 3; /* above body rows */
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); /* gradient background */
      color: white; /* white text for better contrast */
      font-weight: bold;
    }
    
    /* Help icon on labels */
    .label.is-small {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem; /* space between text and icon */
    }

    .label .help-icon {
      font-size: 0.9rem;          /* slightly smaller than label text */
      color: #9aa0a6;             /* subtle gray */
      cursor: help;               /* indicates tooltip/help */
      vertical-align: middle;
      line-height: 1;
      opacity: 0.9;
      margin-left: 0.2rem;
      transition: color 0.15s ease, opacity 0.15s ease, transform 0.15s ease;
    }

    .label .help-icon:hover,
    .label .help-icon:focus {
      color: #1976d2;             /* your blue */
      opacity: 1;
      transform: translateY(-1px);
    }

    .label .help-icon i {
      line-height: 1;             /* keep icon snug vertically */
    }

    /* Custom tooltip styling */
    .help-icon {
      position: relative;
    }

    .help-icon::after {
      content: attr(title);
      position: absolute;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      background-color: #333;
      color: white;
      padding: 8px 12px;
      border-radius: 4px;
      font-size: 0.75rem;
      white-space: nowrap;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s, visibility 0.3s;
      z-index: 1000;
      pointer-events: none;
    }

    .help-icon::before {
      content: '';
      position: absolute;
      bottom: 115%;
      left: 50%;
      transform: translateX(-50%);
      border: 5px solid transparent;
      border-top-color: #333;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s, visibility 0.3s;
      z-index: 1000;
    }

    .help-icon:hover::after,
    .help-icon:hover::before {
      opacity: 1;
      visibility: visible;
    }


  </style>
</head>
<body>
  <div class="container">
    <div class="header-row">
      <img src="/uploads/logo.webp" alt="Logo" width="250" />
      <h1 class="title is-4">Contact Center Report for SPC</h1>
    </div>


    <form id="filterForm" class="box p-4">
      <!-- Account field removed as it's no longer needed -->


      <div class="columns is-variable is-2">
        <div class="column">
          <label class="label">Start datetime</label>
          <input id="start" class="input" type="datetime-local" required />
        </div>
        <div class="column">
          <label class="label">End datetime</label>
          <input id="end" class="input" type="datetime-local" required />
        </div>
      </div>


      <!-- Advanced filters section - Row 1 -->
      <div class="columns is-multiline">
        <!-- Row 1: First 6 filters -->
        <!-- <div class="column is-2">
          <div class="field">
            <label class="label is-small">Caller ID Number</label>
            <div class="control">
              <input id="caller_id_number" class="input is-small" type="text" placeholder="Caller number" />
            </div>
          </div>
        </div>
        <div class="column is-2">
          <div class="field">
            <label class="label is-small">Callee ID Number</label>
            <div class="control">
              <input id="callee_id_number" class="input is-small" type="text" placeholder="Callee number" />
            </div>
          </div>
        </div> -->
        <div class="column is-2">
          <div class="field">
            <label class="label is-small">
              Contact Number
              <span
                class="help-icon"
                title="Please remove the extra spaces"
                aria-label="Please remove the extra spaces"
              >
              <i class="fas fa-circle-info"></i>
            </span>
          </label>
          
            <div class="control">
              <input id="contact_number" class="input is-small" type="text" placeholder="Enter number" />
            </div>
          </div>
        </div>
        
        <div class="column is-2">
          <div class="field">
            <label class="label is-small">Record Type</label>
            <div class="control">
              <div class="select is-small is-fullwidth">
                <select id="record_type">
                  <option value="">All Types</option>
                  <option value="Inbound">Inbound</option>
                  <option value="Outbound">Outbound</option>
                  <option value="Campaign">Campaign</option>
                </select>
              </div>
            </div>
          </div>
        </div>
        
        <div class="column is-2">
          <div class="field">
            <label class="label is-small">Agent Name</label>
            <div class="control">
              <input id="agent_name" class="input is-small" type="text" placeholder="Agent name" />
            </div>
          </div>
        </div>
        <div class="column is-2">
          <div class="field">
            <label class="label is-small">Extension</label>
            <div class="control">
              <input id="extension" class="input is-small" type="text" placeholder="Extension" />
            </div>
          </div>
        </div>
        <div class="column is-2">
          <div class="field">
            <label class="label is-small">Queue/Campaign Name</label>
            <div class="control">
              <input id="queue_campaign_name" class="input is-small" type="text" placeholder="Queue/Campaign name" />
            </div>
          </div>
        </div>

        <!-- Row 2: Next 6 filters -->
        <div class="column is-2">
          <div class="field">
            <label class="label is-small">Agent Disposition</label>
            <div class="control">
              <input id="agent_disposition" class="input is-small" type="text" placeholder="Agent disposition" />
            </div>
          </div>
        </div>
        <div class="column is-2">
          <div class="field">
            <label class="label is-small">Sub Disposition 1</label>
            <div class="control">
              <input id="sub_disp_1" class="input is-small" type="text" placeholder="Sub disposition 1" />
            </div>
          </div>
        </div>
        <div class="column is-2">
          <div class="field">
            <label class="label is-small">Sub Disposition 2</label>
            <div class="control">
              <input id="sub_disp_2" class="input is-small" type="text" placeholder="Sub disposition 2" />
            </div>
          </div>
        </div>
        <div class="column is-2">
          <div class="field">
            <label class="label is-small">Status</label>
            <div class="control">
              <div class="select is-small is-fullwidth">
                <select id="status">
                  <option value="">All</option>
                  <option value="Success">Success</option>
                  <option value="Failed">Failed</option>
                  <option value="Cooloff">Cooloff</option>
                </select>
              </div>
            </div>
          </div>
        </div>
        <div class="column is-2">
          <div class="field">
            <label class="label is-small">Campaign Type</label>
            <div class="control">
              <div class="select is-small is-fullwidth">
                <select id="campaign_type">
                  <option value="">All</option>
                  <option value="Progressive">Progressive</option>
                  <option value="Preview">Preview</option>
                </select>
              </div>
            </div>
          </div>
        </div>
        <div class="column is-2">
          <div class="field">
            <label class="label is-small">Country</label>
            <div class="control">
              <input id="country" class="input is-small" type="text" placeholder="Country" />
            </div>
          </div>
        </div>
        <div class="column is-2">
          <div class="field">
            <label class="label is-small">Transfer Call</label>
            <div class="control">
              <div class="select is-small is-fullwidth">
                <select id="transferred">
                  <option value="">All</option>
                  <option value="1">Yes</option>
                  <option value="0">No</option>
                </select>                
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="field has-text-centered">
        <button id="fetchBtn" type="submit" class="button is-primary btn-fetch">Fetch Reports</button>
      </div>
    </form>


    <div id="loading" class="notification is-info is-light is-hidden">
      <span class="icon"><i class="fas fa-spinner fa-spin"></i></span>
      Loadingâ€¦ Please wait.
    </div>
    <div id="errorBox" class="notification is-danger is-light is-hidden"></div>

    <div id="pageNav" class="is-hidden">
      <button class="pagination-previous is-disabled" id="prevPage" disabled>Previous</button>
      <span id="pageInfo">Page 1 of 1</span>
      <span id="recordInfo">Showing 0-0 of 0 records</span>
      <button class="pagination-next is-disabled" id="nextPage" disabled>Next</button>
    </div>
    
    <!-- Record count will be displayed here -->
    <div id="stats" class="notification is-primary is-light is-hidden"></div>

    <div class="table-container">
      <table id="resultTable" class="table is-fullwidth is-striped is-hoverable"></table>
    </div>


    <div class="has-text-centered mt-2">
      <button id="csvBtn" class="button is-link is-light" disabled>Download CSV</button>
    </div>


    <div class="mt-1 has-text-centered">Copyright @ 2025. All Rights Reserved by Multycomm</div>
  </div>


  <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.2/build/global/luxon.min.js"></script>
  <script src="final-report.js"></script>
</body>
</html>
